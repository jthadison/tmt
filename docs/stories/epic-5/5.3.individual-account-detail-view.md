# Story 5.3: Individual Account Detail View

## Status
Ready

## Story
**As a** trader,  
**I want** detailed information about each account,  
**so that** I can analyze performance and make adjustments.

## Acceptance Criteria
1. Position list with entry, current price, P&L, and time held
2. Trade history with filtering and sorting capabilities
3. Performance chart showing equity curve over time
4. Risk metrics dashboard: Sharpe ratio, win rate, profit factor
5. Prop firm rule compliance status with remaining limits
6. Manual trade override controls with confirmation dialogs

## Tasks / Subtasks

- [ ] Task 1: Create position list component (AC: 1)
  - [ ] Design position table with sortable columns
  - [ ] Display entry price, current price, P&L, and duration
  - [ ] Add position type indicators (long/short)
  - [ ] Implement real-time price updates
  - [ ] Add position size and risk information
  
- [ ] Task 2: Build trade history interface (AC: 2)
  - [ ] Create paginated trade history table
  - [ ] Implement filtering by date range, symbol, P&L
  - [ ] Add sorting by multiple columns
  - [ ] Include trade details modal/drawer
  - [ ] Export functionality for trade data
  
- [ ] Task 3: Develop equity curve chart (AC: 3)
  - [ ] Integrate charting library (Chart.js or D3)
  - [ ] Create time-series equity curve visualization
  - [ ] Add zoom and pan functionality
  - [ ] Implement multiple timeframe views (1D, 1W, 1M, 3M, 1Y)
  - [ ] Add drawdown overlay visualization
  
- [ ] Task 4: Implement risk metrics dashboard (AC: 4)
  - [ ] Calculate and display Sharpe ratio
  - [ ] Show win rate percentage
  - [ ] Display profit factor calculation
  - [ ] Add maximum drawdown metrics
  - [ ] Include risk-adjusted returns
  
- [ ] Task 5: Create compliance status monitor (AC: 5)
  - [ ] Display prop firm rule limits and current usage
  - [ ] Show daily/monthly loss limits with progress bars
  - [ ] Monitor minimum trading days requirements
  - [ ] Alert for rule violations or approaching limits
  - [ ] Display account tier and requirements
  
- [ ] Task 6: Build manual trade override system (AC: 6)
  - [ ] Create emergency stop trading button
  - [ ] Add manual position close controls
  - [ ] Implement trade size override interface
  - [ ] Add multi-step confirmation dialogs
  - [ ] Include override reason logging

## Dev Notes

### Architecture Context
This story creates the detailed view for individual trading accounts, providing comprehensive analysis and control capabilities. It serves as the primary interface for traders to monitor specific account performance and make manual interventions when necessary.

### Data Models
[Source: docs/architecture/data-models.md]
```typescript
interface Position {
  id: string;
  symbol: string;
  type: 'long' | 'short';
  size: number;
  entryPrice: number;
  currentPrice: number;
  pnl: number;
  pnlPercentage: number;
  openTime: Date;
  duration: number; // in minutes
  stopLoss?: number;
  takeProfit?: number;
  commission: number;
}

interface Trade {
  id: string;
  symbol: string;
  type: 'long' | 'short';
  size: number;
  entryPrice: number;
  exitPrice: number;
  pnl: number;
  commission: number;
  openTime: Date;
  closeTime: Date;
  duration: number;
  strategy?: string;
}

interface AccountDetails {
  id: string;
  accountName: string;
  propFirm: string;
  positions: Position[];
  recentTrades: Trade[];
  equityHistory: EquityPoint[];
  riskMetrics: RiskMetrics;
  complianceStatus: ComplianceStatus;
  tradingPermissions: TradingPermissions;
}

interface RiskMetrics {
  sharpeRatio: number;
  winRate: number;
  profitFactor: number;
  maxDrawdown: number;
  averageWin: number;
  averageLoss: number;
  totalTrades: number;
}

interface ComplianceStatus {
  dailyLossLimit: { current: number; limit: number; };
  monthlyLossLimit: { current: number; limit: number; };
  maxDrawdown: { current: number; limit: number; };
  minTradingDays: { current: number; required: number; };
  accountTier: string;
  violations: ComplianceViolation[];
}
```

### Component Architecture
[Source: docs/architecture/frontend-architecture.md]
```
components/
├── account-detail/
│   ├── AccountDetailView.tsx     # Main container
│   ├── PositionsTable.tsx       # Active positions display
│   ├── TradeHistory.tsx         # Historical trades
│   ├── EquityCurveChart.tsx     # Performance visualization
│   ├── RiskMetricsDashboard.tsx # Risk statistics
│   ├── ComplianceMonitor.tsx    # Rule compliance status
│   └── ManualOverridePanel.tsx  # Trading controls
```

### Chart Integration
[Source: docs/architecture/frontend-architecture.md]
- Use Chart.js for performance and compatibility
- Implement responsive charts with touch support
- Support multiple timeframes with data aggregation
- Include candlestick and line chart options
- Add technical indicators overlay capability

### API Integration
[Source: docs/architecture/rest-api-spec.md]
- `GET /api/accounts/{id}/details` - Account overview data
- `GET /api/accounts/{id}/positions` - Active positions
- `GET /api/accounts/{id}/trades` - Trade history with pagination
- `GET /api/accounts/{id}/equity-curve` - Historical equity data
- `POST /api/accounts/{id}/override` - Manual trade overrides
- `GET /api/accounts/{id}/compliance` - Rule compliance status

### WebSocket Subscriptions
[Source: docs/architecture/backend-architecture.md]
- `account:{id}:positions:update` - Real-time position updates
- `account:{id}:trades:new` - New trade notifications  
- `account:{id}:equity:update` - Equity curve updates
- `account:{id}:compliance:alert` - Rule violation alerts

### Manual Override Security
[Source: docs/architecture/security.md]
- Multi-factor authentication for sensitive operations
- Audit logging for all manual interventions
- Role-based permissions for override capabilities
- Rate limiting on override actions
- Confirmation dialogs with reason codes

### Performance Considerations
[Source: docs/architecture/frontend-architecture.md]
- Pagination for trade history (25 trades per page)
- Virtual scrolling for large position lists
- Chart data aggregation for different timeframes
- Lazy loading of non-critical sections
- Caching of risk metric calculations

### Testing Standards
- Test position list sorting and real-time updates
- Verify trade history filtering and pagination
- Chart rendering with different data sets
- Risk metric calculation accuracy
- Override confirmation flow testing
- Compliance alert functionality

## Testing

### Test Requirements
[Source: docs/architecture/testing-strategy.md]
- **Unit Tests**: Component rendering, calculations, data formatting
- **Integration Tests**: API calls, WebSocket updates, chart interactions
- **E2E Tests**: Complete account analysis workflow, manual overrides
- **Performance Tests**: Large datasets, chart rendering performance
- **Location**: `dashboard/__tests__/components/account-detail/`

### Specific Testing Focus
- Position table real-time updates and sorting
- Trade history filtering and export functionality
- Equity curve chart performance with large datasets
- Risk metric calculation accuracy
- Manual override security and confirmation flow
- Compliance rule violation detection

### Mock Data Requirements
- Position datasets with various P&L scenarios
- Trade history with 100+ entries for pagination testing
- Equity curve data for different timeframes
- Compliance scenarios (compliant, warning, violation states)

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-12 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
*This section will be populated by the development agent during implementation.*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References  
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent review will be populated here after implementation.*