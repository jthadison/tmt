# Story 5.2: Multi-Account Overview Screen

## Status
Ready

## Story
**As a** trader,  
**I want** to see all my accounts at a glance,  
**so that** I can quickly assess overall performance and risk.

## Acceptance Criteria
1. Grid view showing all accounts with key metrics per account
2. Traffic light status indicators (green/yellow/red) for account health
3. Real-time P&L updates with percentage and dollar amounts
4. Drawdown visualization with progress bars
5. Active position count and total exposure per account
6. One-click drill-down to individual account details

## Tasks / Subtasks

- [ ] Task 1: Create account overview grid layout (AC: 1)
  - [ ] Design responsive grid component for account cards
  - [ ] Implement account card component with key metrics
  - [ ] Add grid sorting and filtering capabilities
  - [ ] Configure auto-refresh for account data
  
- [ ] Task 2: Implement account health status indicators (AC: 2)
  - [ ] Create traffic light status component (green/yellow/red)
  - [ ] Define health status calculation logic
  - [ ] Map account risk metrics to status colors
  - [ ] Add status change animations and alerts
  
- [ ] Task 3: Build real-time P&L display system (AC: 3)
  - [ ] Create P&L component with percentage and dollar display
  - [ ] Implement WebSocket subscription for P&L updates
  - [ ] Add color coding for positive/negative P&L
  - [ ] Include daily, weekly, and total P&L metrics
  
- [ ] Task 4: Develop drawdown visualization (AC: 4)
  - [ ] Create progress bar component for drawdown display
  - [ ] Calculate drawdown percentages vs. maximum limits
  - [ ] Implement color-coded progress bars (safe/warning/danger)
  - [ ] Add hover tooltips with detailed drawdown information
  
- [ ] Task 5: Display position and exposure metrics (AC: 5)
  - [ ] Create position counter with live updates
  - [ ] Calculate and display total exposure per account
  - [ ] Add position type breakdown (long/short)
  - [ ] Implement exposure limit warnings
  
- [ ] Task 6: Implement account drill-down navigation (AC: 6)
  - [ ] Add click handlers to account cards
  - [ ] Create navigation to detailed account view
  - [ ] Implement smooth page transitions
  - [ ] Add breadcrumb navigation for easy return

## Dev Notes

### Architecture Context
This story creates the main dashboard overview screen that provides traders with a comprehensive view of all their trading accounts. It serves as the primary entry point after authentication and the central hub for monitoring multiple prop firm accounts simultaneously.

### Data Models
[Source: docs/architecture/data-models.md]
```typescript
interface AccountOverview {
  id: string;
  accountName: string;
  propFirm: string;
  balance: number;
  equity: number;
  pnl: {
    daily: number;
    weekly: number;
    total: number;
    percentage: number;
  };
  drawdown: {
    current: number;
    maximum: number;
    percentage: number;
  };
  positions: {
    active: number;
    long: number;
    short: number;
  };
  exposure: {
    total: number;
    limit: number;
    utilization: number;
  };
  status: 'healthy' | 'warning' | 'danger';
  lastUpdate: Date;
}
```

### Component Architecture
[Source: docs/architecture/frontend-architecture.md]
```
components/
├── dashboard/
│   ├── AccountOverviewGrid.tsx    # Main grid container
│   ├── AccountCard.tsx           # Individual account card
│   ├── StatusIndicator.tsx       # Traffic light component
│   ├── PnLDisplay.tsx           # P&L metrics component
│   ├── DrawdownBar.tsx          # Progress bar for drawdown
│   └── PositionMetrics.tsx      # Position count and exposure
```

### WebSocket Integration
[Source: docs/architecture/backend-architecture.md]
- Subscribe to account update events: `accounts:overview:update`
- Handle real-time P&L updates: `accounts:pnl:update`
- Process position change notifications: `accounts:positions:change`
- Manage connection state and error handling

### State Management
[Source: docs/architecture/frontend-architecture.md]
- Use React Query for server state management
- Implement optimistic updates for real-time data
- Cache account data with 30-second stale time
- Handle offline/online state transitions

### Health Status Logic
Account health determination based on:
- **Green (Healthy)**: Drawdown < 50% of limit, P&L positive or minor negative
- **Yellow (Warning)**: Drawdown 50-80% of limit, or significant daily losses
- **Red (Danger)**: Drawdown > 80% of limit, approaching daily loss limits

### Performance Considerations
[Source: docs/architecture/frontend-architecture.md]
- Virtualize grid for accounts > 20
- Implement lazy loading for account details
- Use React.memo for account card optimization
- Debounce real-time updates to prevent UI thrashing

### Testing Standards
- Test grid rendering with various account counts (1, 5, 20, 50+)
- Verify real-time update handling and WebSocket reconnection
- Test status indicator color changes and calculations
- Validate drawdown progress bar accuracy
- Test responsive behavior across device sizes

## Testing

### Test Requirements
[Source: docs/architecture/testing-strategy.md]
- **Unit Tests**: Component rendering, status calculations, data formatting
- **Integration Tests**: WebSocket data flow, API integration
- **E2E Tests**: Account navigation, real-time updates, responsive behavior
- **Performance Tests**: Large dataset rendering (50+ accounts)
- **Location**: `dashboard/__tests__/components/dashboard/`

### Specific Testing Focus
- Account health status calculation accuracy
- Real-time P&L update performance
- Grid responsiveness with different account counts
- WebSocket connection resilience
- Navigation flow to account details

### Mock Data Requirements
- Create test fixtures for 1, 5, 20, and 50 account scenarios
- Include various account states (healthy, warning, danger)
- Mock WebSocket events for real-time testing

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-12 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
*This section will be populated by the development agent during implementation.*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References  
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent review will be populated here after implementation.*