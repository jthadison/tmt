# Story 4.1b: DXtrade Platform Integration

## Status
Draft

## Story
**As an** execution system,
**I want** direct integration with DXtrade platform,
**so that** I can execute trades on prop firm accounts requiring DXtrade.

## Acceptance Criteria
1. DXtrade FIX API and REST API integration complete
2. SSL certificate-based authentication implemented
3. Order execution completes within 150ms of signal generation
4. FIX protocol message handling for real-time updates
5. Support for all order types via FIX 4.4 protocol
6. Automatic FIX session recovery and gap fill
7. Message sequence number management
8. Multi-session support for different accounts

## Tasks / Subtasks
- [ ] Task 1: Set up DXtrade FIX connectivity (AC: 1, 2)
  - [ ] Configure SSL certificates for authentication
  - [ ] Implement FIX 4.4 protocol handler
  - [ ] Create FIX session management
  - [ ] Set up message encryption
  - [ ] Implement heartbeat and test request handling

- [ ] Task 2: Implement FIX order management (AC: 1, 3, 5)
  - [ ] Create NewOrderSingle message builder
  - [ ] Implement OrderCancelRequest handling
  - [ ] Add OrderCancelReplaceRequest for modifications
  - [ ] Create execution report parser
  - [ ] Implement order status request handling
  - [ ] Add support for all FIX order types

- [ ] Task 3: Build REST API integration (AC: 1)
  - [ ] Implement REST authentication
  - [ ] Create account information endpoints
  - [ ] Add historical data retrieval
  - [ ] Implement symbol information queries
  - [ ] Create margin requirement checks

- [ ] Task 4: Implement real-time data handling (AC: 4)
  - [ ] Create market data request handlers
  - [ ] Implement quote processing
  - [ ] Add position report handling
  - [ ] Create account summary updates
  - [ ] Implement trade capture reports

- [ ] Task 5: Build session management (AC: 6, 7, 8)
  - [ ] Implement sequence number persistence
  - [ ] Create gap fill request handling
  - [ ] Add session recovery logic
  - [ ] Implement resend request processing
  - [ ] Create multi-session coordinator
  - [ ] Add session scheduling (start/end times)

- [ ] Task 6: Optimize performance (AC: 3)
  - [ ] Implement FIX message pre-allocation
  - [ ] Create message batching where appropriate
  - [ ] Add binary FIX encoding (FIXP) support
  - [ ] Implement zero-copy message handling
  - [ ] Add performance monitoring metrics

- [ ] Task 7: Create error handling and recovery (AC: 6)
  - [ ] Implement reject message handling
  - [ ] Add business reject processing
  - [ ] Create sequence reset handling
  - [ ] Build automatic reconnection logic
  - [ ] Add comprehensive FIX logging

## Dev Notes

### DXtrade Specifications
- **FIX Version:** 4.4 with custom extensions
- **Message Types:** Standard FIX + DXtrade custom tags (5000-5999)
- **Encryption:** SSL/TLS 1.2+ required
- **Sequence Numbers:** Persistent, reset daily at session start

### Connection Details
- **FIX Gateway:** `fix.dxtrade.com:443`
- **REST API:** `https://api.dxtrade.com/v2`
- **Market Data:** Separate FIX session required
- **Latency:** Typically 30-80ms for FIX messages

### Performance Optimizations
- Use QuickFIX/J or QuickFIX C++ for optimal performance
- Implement connection pooling for REST API
- Pre-calculate FIX checksums where possible
- Use memory-mapped files for sequence number storage

### Integration Architecture
- Implement as separate service in execution-engine
- Use platform abstraction layer for unified interface
- Store certificates in HashiCorp Vault
- Maintain FIX logs for compliance (7 years)

## Testing
- Unit tests for FIX message building/parsing
- Integration tests with DXtrade test environment
- Session recovery testing
- Gap fill and resend testing
- Performance testing under load
- Failover testing between primary/backup

## Dependencies
- Platform Abstraction Layer (Story 4.1c)
- SSL certificates from DXtrade
- FIX protocol library (QuickFIX)
- DXtrade test account access

## Compliance Notes
- FIX logs must be retained for regulatory compliance
- All messages must include proper CompID and SubID
- Implement audit trail for all order modifications
- Support regulatory reporting tags

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-01-07 | 1.0 | Initial story creation for DXtrade integration | Sarah (PO) |